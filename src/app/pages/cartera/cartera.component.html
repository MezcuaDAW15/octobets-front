<main class="flex flex-col gap-10 h-full w-full overflow-auto font-poppins">

  <!-- ▸ SALDO + MASCOTA --------------------------------------------------->
  <section class="flex items-center justify-between
           bg-gradient-to-r from-primary/10 to-primary/5
           ring-1 ring-primary/20
           rounded-3xl p-8 shadow-lg">

    <div>
      <h2 class="text-2xl md:text-3xl font-oswald text-text-primary mb-1">
        Tu saldo
      </h2>
      <p class="text-3xl md:text-4xl font-bold text-primary drop-shadow-sm">
        {{ balance() | number:'1.0-0':'es-ES' }} fichas
      </p>
    </div>

    <img src="/assets/images/dinerito.png" alt="Octo, la mascota de OctoBets"
      class="h-24 w-24 md:h-28 md:w-28 object-contain select-none pointer-events-none" />
  </section>
  <div class="flex">
    <button class="flex items-center gap-2 px-5 py-2.5 rounded-full
           bg-surface-light hover:bg-primary/20 text-primary font-semibold
           transition align-middle" routerLink="/transacciones">
      <mat-icon class="text-lg md:text-xl">receipt_long</mat-icon>
      Ver historial de transacciones
    </button>
  </div>
  <!-- ▸ FORMULARIOS ------------------------------------------------------->
  <section class="grid grid-cols-1 xl:grid-cols-2 gap-10">

    <!-- COMPRAR ---------------------------------------------------------->
    <div class="card">
      <h3 class="card-title">Comprar fichas</h3>

      <form [formGroup]="buyForm" (ngSubmit)="onBuy()" class="space-y-5">
        <!-- Euros -->
        <label class="form-field">
          <span>Euros</span>
          <input type="number" formControlName="euros" min="1" step="1" placeholder="1 € = 100 fichas" class="input" />
        </label>
        <p *ngIf="buyForm.get('euros')?.invalid && buyForm.get('euros')?.touched" class="error-msg">Introduce al menos 1
          €.</p>

        <!-- Stripe card-element -->
        <div id="card-element" class="border border-border rounded-xl p-3 bg-surface-light"></div>

        <button type="submit" [disabled]="buyForm.invalid || processing" class="btn-primary self-end">
          Confirmar pago
        </button>
      </form>
    </div>

    <!-- RETIRAR ---------------------------------------------------------->
    <div class="card">
      <h3 class="card-title">Retirar fichas</h3>

      <form [formGroup]="withdrawForm" (ngSubmit)="onWithdraw()" class="space-y-5">
        <!-- Fichas -->
        <label class="form-field">
          <span>Fichas</span>
          <input type="number" formControlName="chips" min="100" step="100" placeholder="Ej: 500" class="input" />
        </label>
        <p *ngIf="withdrawForm.get('chips')?.invalid && withdrawForm.get('chips')?.touched" class="error-msg">Mínimo 100
          fichas.</p>

        <button type="submit" [disabled]="withdrawForm.invalid || processing" class="btn-success self-end">
          Retirar fondos
        </button>
      </form>
    </div>
  </section>

</main>

<!-- ======== UTILIDADES SCOPED A ESTE COMPONENTE ========================-->
<style>
  /* Tarjeta genérica */
  .card {
    @apply bg-surface-light/90 backdrop-blur-sm rounded-3xl p-8 ring-1 ring-white/5 shadow-lg flex flex-col;
  }

  .card-title {
    @apply text-text-primary text-2xl font-semibold mb-6;
  }

  /* Campo */
  .form-field {
    @apply flex flex-col gap-1;
  }

  .form-field>span {
    @apply text-text-secondary font-medium;
  }

  .input {
    @apply w-full bg-surface-light border border-border rounded-xl px-4 py-2 text-text-primary placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary;
  }

  /* Botones */
  .btn-primary {
    @apply px-6 py-3 rounded-full bg-primary hover:bg-primary-dark text-white font-semibold shadow transition disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-primary;
  }

  .btn-success {
    @apply px-6 py-3 rounded-full bg-success hover:bg-success-dark text-white font-semibold shadow transition disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-success;
  }

  /* Mensaje error */
  .error-msg {
    @apply text-danger text-sm -mt-2;
  }
</style>